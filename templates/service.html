{% extends 'base.html' %}
{% block content %}

<div class="create-tour">
    <h2>Trình tạo Tour nhanh</h2>
    <p>Hãy cung cấp một vài thông tin để chúng tôi có thể cá nhân hóa chuyến đi của bạn.</p>
    <form class="input-form">
        <div class="form-section">
            <h3>1. Chọn Ngày Du lịch</h3>
            <div class="date-group-flex">
                <div class="form-group">
                    <label for="start-date">Ngày khởi hành</label>
                    <input type="date" id="start-date" required>
                </div>
                <div class="form-group">
                    <label for="end-date">Ngày kết thúc</label>
                    <input type="date" id="end-date" required>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>2. Chọn sở thích của bạn</h3>
            <p class="description">Chọn tối thiểu 3 sở thích để nhận được gợi ý chính xác nhất.</p>
            <div class="tag-group">
                <input type="checkbox" id="tag-amthuc" name="interest" value="street-food">
                <label for="tag-amthuc">Ẩm thực đường phố</label>

                <input type="checkbox" id="tag-leo-nui" name="interest" value="climbing">
                <label for="tag-leo-nui">Leo núi</label>
                
                <input type="checkbox" id="tag-maohiem" name="interest" value="adventure">
                <label for="tag-maohiem">Mạo hiểm</label>
                
                <input type="checkbox" id="tag-thugian" name="interest" value="relaxation">
                <label for="tag-thugian">Tận hưởng / Thư giãn</label>
                
                <input type="checkbox" id="tag-ngoai-troi" name="interest" value="outdoor">
                <label for="tag-ngoai-troi">Hoạt động ngoài trời</label>

                <input type="checkbox" id="tag-chup-anh" name="interest" value="photography">
                <label for="tag-chup-anh">Chụp ảnh</label>
            </div>
        </div>

        <div class="form-section">
            <h3>3. Lễ hội / Sự kiện chính</h3>
            <p class="description">Chúng tôi gợi ý các lễ hội phù hợp với ngày và sở thích của bạn. (Vui lòng chọn 1)</p>
            <div class="festival-group">
                
                <input type="radio" id="festival-chua-huong" name="main-festival" value="chua-huong" checked>
                <label for="festival-chua-huong" class="festival-card active-card">
                    <div class="card-image-wrapper">
                        <img src="{{ url_for('static', filename='images/banner-image.jpg') }}" alt="Chùa Hương">
                        <div class="card-badge">ĐÃ GỢI Ý</div>
                    </div>
                    <h4>Lễ hội Chùa Hương</h4>
                    <p class="card-info">Hà Nội</p>
                </label>

                <input type="radio" id="festival-hoa-phuong" name="main-festival" value="hoa-phuong">
                <label for="festival-hoa-phuong" class="festival-card">
                    <div class="card-image-wrapper">
                        <img src="{{ url_for('static', filename='images/avatar.jpg') }}" alt="Hoa Phượng Đỏ">
                        <div class="card-badge">KHÁM PHÁ</div>
                    </div>
                    <h4>Lễ hội Hoa Phượng Đỏ</h4>
                    <p class="card-info">Hải Phòng</p>
                </label>

                <input type="radio" id="festival-mien-tay" name="main-festival" value="mien-tay">
                <label for="festival-mien-tay" class="festival-card">
                    <div class="card-image-wrapper">
                         <img src="{{ url_for('static', filename='images/icon_web.png') }}" alt="Miền Tây">
                        <div class="card-badge">KHÁM PHÁ</div>
                    </div>
                    <h4>Văn hóa Miền Tây</h4>
                    <p class="card-info">Cần Thơ</p>
                </label>
                
                <div class="card-placeholder"></div>
                <div class="card-placeholder"></div>

            </div>
            
            <button type="button" class="form-button more-festival-button">Xem tất cả các lễ hội khác</button>
        </div>

        <button type="submit" class="hero-button create-tour-button">Tạo Tour Ngay</button>
    </form>
</div>

<div class="service-container">
    <h2>Bản đồ du lịch</h2>
    <p>Khám phá các điểm nổi bật trên bản đồ dưới đây</p>
    <div class="map-wrapper">
        {{map_html|safe}}
    </div>
</div>

<script>
    // Lấy các tham số từ URL hiện tại
    const urlParams = new URLSearchParams(window.location.search)

    // Chạy script khi URL chưa có tham số lat
    if(!urlParams.has('lat')){
        // Kiểm tra trình duyệt có hỗ trợ Geolocation không
        if(navigator.geolocation){
            // Nếu có, gọi hàm lấy vị trí
            navigator.geolocation.getCurrentPosition(
                // 1. Hàm xử lý khi thành công 
                function(position){
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    // Tải lại trang với tọa độ mới
                    window.location.href = `/service?lat=${lat}&lon=${lon}`;
                },
                // 2. Hàm xử lý khi bị từ chối hay thất bại
                function(error){
                    console.error("Lỗi không tìm thấy vị trí: ", error.message)
                }
            );
        }
        else{
            console.log("Trình duyệt của bạn không hỗ trợ Geolocation.");
        }
    }
</script>

{% endblock %}